#!/usr/bin/env bash

set -euo pipefail

if [ $# -ne 1 ]; then
    echo "Usage: $0 <youtube-url>"
    exit 1
fi

URL="$1"

# 1️⃣ Get full title
FULL_TITLE=$(yt-dlp --get-title "$URL")

# 2️⃣ Extract part before '|'
RAW_TOPIC=$(echo "$FULL_TITLE" | cut -d '|' -f 1 | sed 's/[[:space:]]*$//')

# 3️⃣ Sanitize for folder name
SANITIZED_TOPIC=$(echo "$RAW_TOPIC" \
    | sed 's/std::/std /g' \
    | sed 's/[^a-zA-Z0-9 +_#-\(\)]//g' \
    | sed 's/[[:space:]]\+/ /g' \
    | sed 's/^ *//; s/ *$//')


# 4️⃣ Get next folder number
LAST_NUM=$(ls -1d [0-9][0-9]* 2>/dev/null \
    | sort -n \
    | tail -n 1 \
    | cut -d ' ' -f 1 \
    | cut -d '-' -f 1)

if [ -z "${LAST_NUM:-}" ]; then
    NEXT_NUM="01"
else
    NEXT_NUM=$(printf "%02d" $((10#$LAST_NUM + 1)))
fi

FOLDER_NAME="$NEXT_NUM - $SANITIZED_TOPIC"

# 5️⃣ Create directory
mkdir "$FOLDER_NAME"

# 6️⃣ Create main.cpp
cat <<EOF > "$FOLDER_NAME/main.cpp"
#include <iostream>

int main() {
    return 0;
}
EOF

# 7️⃣ Create Notes.md with UNSANITIZED title
echo "# $RAW_TOPIC" > "$FOLDER_NAME/Notes.md"

echo "Created: $FOLDER_NAME"

